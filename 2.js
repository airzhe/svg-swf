(function(window){
    var WIDTH = 1024, HEIGHT = 768, SCREEN = window.SCREEN || 3;
    var svg = Snap('#screen').attr({'class':'bg_black'});
    // console.log(container)
    var shape = {};
    shape.common = {};
    // function
    var fun = {};
    fun.sizeBody = function(){
        var width = window.innerWidth, height = window.innerHeight;
        var transfrom = "scale(" + [height / HEIGHT, height / HEIGHT].join() + ")";
        document.body.style.webkitTransform = transfrom;
        document.body.style.transfrom = transfrom;
    }
    fun.sizeBody();
    window.addEventListener('resize',fun.sizeBody);

    // yuanjan
    var element = {};
    element = {
       'screen1':{
            'title':'每逢佳节被思亲',
            'path1':''
       },
       'screen2':{

       }
    }

    // screen
    var screen = {
        '1': function(){
                shape[1] = _self = {}
                // path
                pathAttr = {
                    'stroke': 'yellow',
                    'strokeWidth':'1',
                }
                _self.path1 = svg.path('M 0 140 Q  80 95 140 100 Q  210 100 300 0').attr(pathAttr).attr({ 'transform':'matrix(1,0,0,1,30,70)'});
                _self.path2 = svg.path('M 0 0 Q  130 110 220 40 ').attr(pathAttr).attr({ 'transform':'matrix(1,0,0,1,804,0)'});
                _self.path3 = svg.path('M 0 0 C  5 100 60 100 100 80 S 180 50  300 100').attr(pathAttr).attr({ 'transform':'matrix(1,0,0,1,0,668)'});
                // title
                var title_text = svg.paper.text(0,0,'每逢佳节倍思亲').attr({
                        'fill':'#fff',
                        'font-size':40,
                        'font-family':'方正隶书简体',
                        'dx':'3,3,3,3,3,3',
                        'transform':'rotate(-20)',
                })
                _self.title = svg.g(title_text).attr({
                    'transform':'matrix(1,0,0,1,40,200)'
                });
                // console.log(shape[1],_self);
               
                // sign
                var signText = svg.text(10,40,['如果','的事']).attr({
                    'fill':'red',
                    'font-size':30,
                    'dx':'5,5,5,5',
                     'font-family':'迷你繁篆书'
                });
                signText.select('tspan:nth-child(2)').attr({
                    'x':10,
                    'y':80
                })

                var signBorder = svg.rect(8,8,80,84).attr({
                    'fill':'none',
                     'stroke-width':2,
                     'stroke':'red',
                     'stroke-dasharray':'20,10,5,5,5,10'
                })

                _self.sign = svg.g(signText,signBorder).attr({
                    'transform':'matrix(1,0,0,1,920,650)'
                })

                 // playBtn
                var bigCircle = svg.circle(70,70,70).attr({"fill":"#59dc19"});

                var smallCircle = svg.ellipse(70,50,60,50).attr({"fill":"l(1,0,1,1)rgba(255,255,255,1)-rgba(89,220,16,.6)"});
                var btnPlay = svg.polyline(0,0,0,60,50,30).attr({
                    'fill':'#fff',
                    'transform':'matrix(1,0,0,1,55,36)'
                })
                var textPlay = svg.text(0,0,'play').attr({
                    'class':'hide',
                    'fill':'#fff',
                    'font-size':50,
                    'transform':'matrix(1,0,0,1,25,75)'
                })
                _self.play = svg.g(bigCircle,smallCircle,btnPlay,textPlay).attr({
                    'class':'btn',
                    'transform':'matrix(.8,0,0,.8,480,300)'
                }).hover(function(){
                    textPlay.attr({'class':''});
                    btnPlay.attr({'class':'hide'});
                },function(){
                    btnPlay.attr({'class':''});
                    textPlay.attr({'class':'hide'});
                }).click(function(){
                    fun.transitions();
                })
        },
        '2': function(){
            svg.attr({'class':''});
            shape[2] = _self = {};
            // book
            var rBook = svg.rect(0,0,90,124);
            _self.book = svg.g(rBook,rBook.clone());
            _self.book.select('rect:nth-child(1)').attr({
                opacity:.17,
                transform:'matrix(1,-.12,0,1,95,11)'
            })
            _self.book.select('rect:nth-child(2)').attr({
                opacity:.40,
                transform:'matrix(1,.12,0,1,0,0)'
            })
            _self.book.attr({
                transform:'matrix(1,0,0,1,820,20)'
            })
            // mask
            _self.mask = svg.rect(0,0,660,0).attr({fill:'#fff'}).animate({
                'height':'260'
            },10000,function(){
                 setTimeout(fun.transitions, 1000);
            });
            // poem
            var poem = [
                '《水调歌头》---（宋）苏东坡',
                '明月几时有？把酒问青天。',
                '不知天上宫阙, 今夕是何年？',
                '我欲乘风归去, 唯恐琼楼玉宇,',
                '高处不胜寒！ 起舞弄清影, 何似在人间？',
                '转朱阁, 低绮户, 照无眠。',
                '不应有恨, 何事长向别时圆？',
                '人有悲欢离合, 月有阴晴圆缺。',
                '此事古难全',
                '但愿人长久, 千里共婵娟。'
            ];
            _self.poem = svg.text(0,0,poem).attr({
                'transform':'matrix(2,0,0,2,150,100)',
                'font-family':'方正隶书简体',
                'mask':_self.mask,
            });
            var rowArr = _self.poem.selectAll('tspan')
            for(var i = 0,len = rowArr.length; i<len; i++){
                rowArr[i].attr({x:20,y:(i+1)*25})
            }
            rowArr[0].attr({
                'x':'10',
                'y':'15',
                'font-size':20
            })
            fun.after(_self.poem);
        },
        '3':function(){
            svg.attr({'class':'bg_black'});
            // moon
            // svg.circle(100,100,70).attr({fill:'r(.5,.5,.5,.5,.5)rgba(255,255,0,1)-rgba(255,255,0,1):75-rgba(255,255,0,0)'});
               var yezi = svg.path('m 203.50913,186.63986 c -2.35987,-0.3624 -4.60987,-0.85575 -5,-1.09636 -0.39012,-0.24061 -5.20932,-0.86781 -10.70932,-1.39378 -5.5,-0.52596 -12.25,-1.46672 -15,-2.09058 -8.88852,-2.01642 -15.65764,-3.08998 -24.16666,-3.83274 -8.51543,-0.74333 -21.50418,-2.72764 -23.75,-3.62832 -1.07209,-0.42996 -1.17318,-2.4869 -0.71024,-14.45217 0.29687,-7.67297 1.1322,-16.95086 1.85627,-20.61753 0.72408,-3.66667 8.11346,-41.145842 8.78196,-44.583342 1.26387,-6.49898 -3.16975,18.089302 -1.11782,11.666672 0.65894,-2.0625 1.19622,-4.57161 1.19395,-5.57581 -0.002,-1.0042 0.32244,-2.027652 0.72158,-2.274332 0.39913,-0.24668 0.94828,-1.56143 1.22033,-2.92167 0.69574,-3.47874 2.99635,-5.98433 4.67155,-5.08779 0.73103,0.39124 4.50988,0.97956 8.39745,1.3074 3.88757,0.32783 7.4433,0.88528 7.90163,1.23879 0.45834,0.3535 5.33334,0.78646 10.83334,0.96211 5.63551,0.18 10.72741,0.75134 11.66666,1.30909 0.91667,0.54433 3.35417,1.55161 5.41667,2.23841 7.55832,2.516852 11.04156,3.881252 14.89895,5.835932 2.1687,1.09897 5.33278,2.25882 7.03128,2.57747 1.6985,0.31864 3.28614,0.89965 3.52808,1.29112 0.24195,0.39148 2.95656,1.89661 6.03247,3.34473 3.0759,1.44812 6.39445,3.36135 7.37455,4.25164 0.9801,0.89028 2.29375,1.50117 2.91923,1.35754 0.62548,-0.14364 2.31897,0.58031 3.76332,1.60877 1.44434,1.02847 2.94318,1.87695 3.33076,1.88553 1.66187,0.0368 12.58434,6.1152 14.87136,8.27602 1.375,1.29913 4.09375,3.1601 6.04167,4.13549 1.94791,0.97539 3.54166,2.08857 3.54166,2.47373 0,0.38516 2.15625,1.90467 4.79167,3.37669 2.63542,1.47202 6.64439,3.95 8.90884,5.50662 2.26444,1.55662 5.1624,3.1946 6.43991,3.63994 3.61762,1.2611 3.70718,-0.52115 0.10151,-2.01982 -1.73723,-0.72206 -4.47865,-2.36932 -6.09207,-3.66057 -1.61341,-1.29125 -4.45099,-3.12192 -6.30574,-4.06814 -1.85476,-0.94622 -3.88614,-2.33957 -4.51418,-3.09632 -0.62805,-0.75675 -3.04047,-2.32296 -5.36093,-3.48046 -2.32045,-1.15749 -5.53151,-3.32459 -7.13567,-4.81577 -2.72068,-2.52905 -11.92444,-7.94967 -13.49788,-7.94967 -0.38605,0 -2.18701,-0.9375 -4.00212,-2.08333 -1.81512,-1.14584 -4.01175,-2.08334 -4.8814,-2.08334 -0.86966,0 -2.03598,-0.54797 -2.59182,-1.21772 -0.55584,-0.66975 -1.82051,-1.46895 -2.81037,-1.776 -0.98986,-0.30705 -2.79514,-1.25907 -4.01172,-2.11561 -1.21658,-0.85653 -2.82211,-1.55733 -3.56783,-1.55733 -0.7457,0 -1.55472,-0.51828 -1.7978,-1.15172 -0.24307,-0.63345 -1.99395,-1.3999 -3.89083,-1.70322 -1.89688,-0.30332 -3.84248,-0.86353 -4.32356,-1.24491 -1.16091,-0.92034 -14.70393,-6.733492 -15.68713,-6.733492 -0.42294,0 -1.95067,-0.52544 -3.39493,-1.16765 -5.56464,-2.47438 -8.58832,-2.99901 -17.28445,-2.99901 -4.94622,0 -9.19453,-0.32586 -9.44067,-0.72414 -0.24615,-0.39826 -3.42933,-0.98423 -7.07375,-1.30214 -4.13696,-0.36087 -6.99968,-1.02801 -7.62035,-1.77586 -0.54678,-0.65883 -1.47947,-1.19786 -2.07265,-1.19786 -0.59318,0 -1.25008,-0.46875 -1.45975,-1.04167 -0.51044,-1.39469 -3.52298,1.72148 -4.29143,4.43906 -0.31404,1.1106 -0.9034,2.76927 -1.30968,3.68594 -0.8029,1.81153 -2.90346,9.760692 -4.53436,17.159472 -0.5649,2.5627 -1.3065,5.11156 -1.64801,5.66414 -0.60264,0.97508 -2.18051,9.06756 -3.9083,20.04452 -0.46472,2.95247 -1.19465,6.02157 -1.62208,6.82021 -0.42742,0.79865 -0.77713,7.66424 -0.77713,15.25688 l -0.41667,12.55478 -8.95833,-1.70297 c -1.26042,-0.0199 3.10416,2.5012 1.04166,2.03777 -9.0844,-2.04123 -11.4713,-2.49812 -15.000003,-2.87127 -3.6743,-0.38855 -10.03199,-2.05765 -15.83333,-4.15678 -1.60417,-0.58044 -6.10417,-1.82477 -10,-2.76517 -3.89583,-0.9404 -8.58333,-2.27426 -10.41667,-2.96413 -1.83333,-0.68987 -4.28529,-1.27077 -5.44879,-1.29089 -1.16351,-0.0201 -3.58655,-0.78653 -5.38454,-1.7032 -1.79799,-0.91666 -4.10515,-1.66666 -5.12702,-1.66666 -1.02187,0 -9.87298,-2.91667 -9.87298,-2.91667 -6.08978,-8.60976 20.76196,-26.74983 12.74488,-20.41667 -9.4031,7.42807 -12.35502,14.88423 -25.17545,12.38767 -0.47974,-0.0934 -1.67157,-1.2456 -2.42347,-1.96372 -3.69596,-3.5299 -9.47942,-8.22253 -10.18972,-11.45654 -0.27793,-1.26541 -0.83354,-2.30074 -1.23469,-2.30074 -0.40115,0 -0.9755905,-1.3125 -1.2765305,-2.91667 -0.30094,-1.60416 -0.82041,-2.91666 -1.15438,-2.91666 -0.33396,0 -1.11333,-1.59375 -1.73192,-3.54167 -0.6186,-1.94792 -1.61612,-4.28136 -2.21672,-5.18542 -0.6006,-0.90406 -1.10393,-2.59156 -1.1185,-3.75 -0.0146,-1.15844 -0.57708,-2.83417 -1.25,-3.72385 -1.50192998,-1.98572 -1.79415998,-22.514682 -0.33335,-23.417512 0.48958,-0.30257 0.68884,-1.0747 0.44282,-1.71584 -0.24603,-0.64114 -0.11929,-1.16571 0.28165,-1.16571 0.40094,0 0.98686,-1.875 1.30205,-4.16667 0.31518,-2.29167 0.91287,-4.16667 1.3282,-4.16667 0.41532,0 0.75513,-0.40864 0.75513,-0.90808 0,-1.2575 3.20291,-3.87876 6.5275405,-5.34213 2.51231,-1.10583 2.72412,-1.46573 2.21823,-3.76907 -0.47207,-2.14928 -0.0604,-3.15769 2.63913,-6.46484 5.9801,-7.32611 14.92998,-15.43423 21.16993,-19.17886 1.63432,-0.980757 3.69682,-2.588157 4.58333,-3.571997 1.53169,-1.69984 10.86975,-6.59835 12.57849,-6.59835 0.44288,0 3.22871,-1.46166 6.19073,-3.24814 2.96202,-1.78647 8.75084,-4.28844 12.86406,-5.55991 4.11321,-1.27148 8.22856,-2.7759 9.14523,-3.34315 3.57126,-2.21 20.539853,-6.0352896 33.333333,-7.5144696 28.75238,-3.32434 54.95935,-3.45714 68.75,-0.34838 4.35417,0.98154 11.66667,2.28968 16.25,2.90699 11.92302,1.6058496 37.38402,8.1098696 45.47761,11.6172596 3.79455,1.64439 7.48941,2.98876 8.21079,2.98749 1.1881,-0.002 4.19591,1.29029 11.3116,4.86035 6.59482,3.30873 22.91667,20.839037 22.91667,24.613407 0,0.67475 0.53956,2.28846 1.19901,3.58602 3.2259,6.34731 3.6388,8.51626 4.17724,21.94253 0.34687,8.64945 0.22513,15.29562 -0.32818,17.91667 -2.07514,9.830022 -2.75514,13.666482 -3.39722,19.166662 -0.77962,6.67829 -2.22984,13.57472 -3.24892,15.44992 -0.38356,0.70579 -0.96659,3.33079 -1.29562,5.83333 -0.32905,2.50255 -1.07589,5.30559 -1.65966,6.22898 -0.58378,0.92338 -1.31994,2.98588 -1.6359,4.58333 -0.31597,1.59744 -0.90717,3.65444 -1.31379,4.57111 -0.4066,0.91667 -1.52255,3.54167 -2.47988,5.83333 -0.95732,2.29167 -2.1037,4.72917 -2.54749,5.41667 -0.4438,0.6875 -1.15197,2 -1.57372,2.91667 -2.17774,4.73332 -14.79389,17.08333 -17.45146,17.08333 -0.82499,0 -1.75697,0.257 -2.07108,0.57112 -0.31412,0.31411 0.11296,1.95832 -1.59723,2.63529 -2.39173,0.94675 -10.00144,0.44557 -26.0261,0.60573 -11.45834,0.11453 -22.76414,-0.0883 -25.12402,-0.45066 z').attr({
                'fill':'#060'
            });
            // 
              var huaban2 = svg.path('m 7.1645624,100.19875 c 0,0 64.6507096,-22.107589 94.1314476,-41.806149 21.78324,-14.55522 71.14607,-53.55796 59.75763,-55.51315 -11.38844,-1.95517 -40.60621,-1.78386 -78.082278,22.86348 -37.47605,24.64724 -80.0374196,65.54632 -80.0374196,65.54632').attr({
                'fill':'l(1,0,1,1)rgba(255,6,6,1)-rgba(255,163,163,1):55-rgba(255,255,255,1)'
            });
            // hehua
            var huaban = svg.path('m 2.5,3.5 c 0,0 90.1,2.2 52,124 C 51.8,136.2 2.4,83.8 7,51.8 12.3,16.4 2.5,3.5 2.5,3.5').attr({
                'fill':'l(1,0,1,1)rgba(255,6,6,1)-rgba(255,163,163,1):55-rgba(255,255,255,1)'
            });
        }
    
    }
    //remove
    fun.remove = function(name) {
        if (shape[name]) {
            shape[name].remove();
            shape[name] = null;
        }
    };
    // transtion
    fun.transitions = function(){
        shape.common.transitions = svg.rect(0,0,1024,768).attr({
            'opacity':0,
            'z-index': 100
        }).animate({
            'opacity':1
        },1500,function(){
            for(var i in shape[SCREEN]){
                if(shape[SCREEN].hasOwnProperty(i)){
                    shape[SCREEN][i].remove();
                }
            }
            SCREEN++;
            screen[SCREEN]();
            this.animate({
            'opacity':0
            },1000,function(){
                this.remove();
            })
        })
    }
    // after
    fun.after = function(obj){
        if(shape.common.transitions){
            shape.common.transitions.insertAfter(obj);
        }
    }
    screen[SCREEN]();
//

})(window)